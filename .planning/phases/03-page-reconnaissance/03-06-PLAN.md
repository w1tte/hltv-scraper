---
phase: 03-page-reconnaissance
plan: 06
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - .planning/phases/03-page-reconnaissance/recon/map-economy.md
autonomous: true

must_haves:
  truths:
    - "CSS selectors for per-round equipment values are documented"
    - "Buy type classification structure (eco, force, full buy, pistol) is documented"
    - "The data source is identified: HTML table vs FusionCharts JSON vs JavaScript-loaded"
    - "Economy data availability for early CS2 matches (late 2023) is verified"
    - "Selectors are verified programmatically against multiple saved HTML samples"
  artifacts:
    - path: ".planning/phases/03-page-reconnaissance/recon/map-economy.md"
      provides: "Complete selector map for HLTV economy sub-page"
      min_lines: 100
  key_links:
    - from: "recon/map-economy.md"
      to: "data/recon/economy-*.html.gz"
      via: "BeautifulSoup .select() verification"
      pattern: "soup\\.select"
---

<objective>
Analyze the HLTV map economy page (`/stats/matches/economy/mapstatsid/{id}/{slug}`) to discover and document CSS selectors for per-round equipment values, buy type classifications, and round outcomes. This is the LEAST documented page type -- no reference project has detailed economy selectors.

Purpose: This selector map addresses the economy data unknown (flagged as LOW confidence in research) and will be consumed by Phase 7 (Economy Extraction).
Output: `.planning/phases/03-page-reconnaissance/recon/map-economy.md`
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-page-reconnaissance/03-RESEARCH.md
@.planning/phases/03-page-reconnaissance/03-01-SUMMARY.md
@.planning/phases/03-page-reconnaissance/recon/sample-manifest.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Exploratory selector discovery for economy page</name>
  <files>.planning/phases/03-page-reconnaissance/recon/map-economy.md</files>
  <action>
This page type has NO known reference selectors. The analysis must be exploratory -- systematically inspect the DOM tree to discover what data is available and how it is structured.

Write a temporary analysis script that loads ALL economy page HTML samples from `data/recon/economy-*.html.gz` and uses BeautifulSoup to map the entire page structure.

**Step 1: Full DOM reconnaissance**
Before looking for specific fields, do a broad scan:
- List ALL unique CSS classes found on the page (sorted by frequency)
- List ALL `data-*` attributes found on any element
- List ALL `<table>` elements with their classes
- List ALL `<script>` tags -- check for FusionCharts or JSON data embedded in JavaScript
- Check for `data-fusionchart-config` attributes (HLTV uses FusionCharts for some visualizations)
- List ALL `<div>` elements with identifiable class patterns (anything with "round", "economy", "equip", "buy", "money")

**Step 2: Per-round economy data**
Based on the DOM scan, identify the elements containing:
- Per-round equipment values for each team (dollar amounts)
- Round numbers (1 through N)
- Side information per round (which team is CT, which is T, and when they switch at half)
- Round outcome per round (win/loss, bomb plant/defuse/elimination/time)

Determine the data format:
- Is economy data in an HTML table? (selector for table, rows, cells)
- Is it in a chart visualization with data in `data-fusionchart-config` JSON? (parse the JSON)
- Is it loaded dynamically via JavaScript after page load? (check if relevant elements are empty in the initial HTML)
- Could it be a combination (visual chart + underlying data table)?

**Step 3: Buy type classifications**
Identify elements showing buy type per round per team:
- Eco round indicator
- Force buy indicator
- Full buy indicator
- Pistol round indicator (rounds 1 and 13 in regulation)
- How are these represented? (CSS classes? Text labels? Color coding? Icons?)

**Step 4: Team attribution**
- How are the two teams distinguished on this page?
- Is team1 always CT-start or is it position-based?
- Are there separate sections per team or interleaved per round?

**Step 5: Overtime economy**
For the overtime sample (if economy data exists for it):
- Do overtime rounds appear in the economy view?
- How are overtime rounds distinguished from regulation rounds?
- Is the economy data truncated to regulation or does it include OT?

**Step 6: Historical availability check**
For the earliest CS2 sample (late 2023):
- Does the economy page have data, or is it empty/minimal?
- Are the same selectors/structures present as on recent match economy pages?
- If empty: document this clearly -- it affects whether the scraper attempts economy extraction for old matches

**Output the documentation with these sections:**
1. **Page Structure Overview** -- high-level DOM tree summary, data sources identified
2. **Data Source Analysis** -- is data in HTML tables, chart JSON, or JS-loaded? Include evidence.
3. **Per-Round Equipment Values** -- selectors, data types, parsing approach
4. **Buy Type Classifications** -- selectors, classification values, how to determine type
5. **Round Outcomes** -- selectors (or note if same as map stats page round history)
6. **Side/Team Attribution** -- how teams and sides (CT/T) are identified
7. **Overtime Handling** -- how OT rounds appear (or don't) in economy data
8. **Historical Availability** -- does economy data exist for early CS2 matches?
9. **Annotated HTML/JSON Snippets** -- key structural examples from actual pages
10. **Extraction Feasibility Assessment** -- can we extract this from saved HTML, or do we need live browser interaction?

**Include annotated snippets for:**
- The primary economy data structure (table rows, chart JSON, or whatever it is)
- Buy type indicators
- One complete round's economy data showing all available fields

**Document ALL visible fields.** Mark with extraction status:
- **extract**: Phase 7 will parse this
- **skip**: Present but not needed
- **infeasible**: Data is JS-loaded and not in initial HTML (would need nodriver interaction)
  </action>
  <verify>
The file `.planning/phases/03-page-reconnaissance/recon/map-economy.md` exists and contains:
1. Data source analysis (HTML table vs chart JSON vs JS-loaded)
2. Per-round equipment value selectors (or documented infeasibility)
3. Buy type classification documentation
4. Historical availability assessment for early CS2 matches
5. Annotated HTML/JSON snippets
6. Extraction feasibility assessment
7. Document is 100+ lines
  </verify>
  <done>Complete economy page analysis exists, data source identified, selectors documented (or infeasibility documented), buy type classification structure mapped, historical availability verified, and extraction feasibility assessed</done>
</task>

</tasks>

<verification>
1. `.planning/phases/03-page-reconnaissance/recon/map-economy.md` exists and is 100+ lines
2. The primary data source is identified (HTML table, FusionCharts JSON, or JavaScript-loaded)
3. Per-round equipment values have extraction path documented (or documented as infeasible)
4. Buy type classifications are documented with their representation in DOM
5. Historical availability for early CS2 matches is checked and documented
6. Extraction feasibility assessment is present -- can we get this from saved HTML or need live browser?
</verification>

<success_criteria>
- Economy page DOM structure is fully mapped (no more "LOW confidence" unknowns)
- Data source for economy values is definitively identified
- Buy type classification scheme is documented
- Historical availability for early CS2 matches is determined
- Extraction feasibility is assessed -- Phase 7 will know whether to parse HTML or need nodriver interaction
- Document resolves the "Economy data availability" concern from STATE.md blockers
</success_criteria>

<output>
After completion, create `.planning/phases/03-page-reconnaissance/03-06-SUMMARY.md`
</output>
