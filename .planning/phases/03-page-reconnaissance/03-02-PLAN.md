---
phase: 03-page-reconnaissance
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - .planning/phases/03-page-reconnaissance/recon/results-listing.md
autonomous: true

must_haves:
  truths:
    - "CSS selectors for every data field on the results listing page are documented"
    - "Pagination structure (offset parameter, entry count per page, stop condition) is documented"
    - "Each match entry's extractable fields are mapped: teams, score, format, date, event, star rating"
    - "Selectors are verified programmatically against multiple saved HTML samples"
  artifacts:
    - path: ".planning/phases/03-page-reconnaissance/recon/results-listing.md"
      provides: "Complete selector map for HLTV /results pages"
      min_lines: 100
  key_links:
    - from: "recon/results-listing.md"
      to: "data/recon/results-offset-*.html.gz"
      via: "BeautifulSoup .select() verification"
      pattern: "soup\\.select"
---

<objective>
Analyze the HLTV results listing page (`/results?offset=N`) to produce a complete CSS selector map documenting every extractable data field, pagination mechanics, and structural patterns.

Purpose: This selector map will be consumed directly by Phase 4 (Match Discovery) to build the results page parser.
Output: `.planning/phases/03-page-reconnaissance/recon/results-listing.md`
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-page-reconnaissance/03-RESEARCH.md
@.planning/phases/03-page-reconnaissance/03-01-SUMMARY.md
@.planning/phases/03-page-reconnaissance/recon/sample-manifest.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Programmatic selector discovery and verification</name>
  <files>.planning/phases/03-page-reconnaissance/recon/results-listing.md</files>
  <action>
Write a temporary analysis script that loads the 3 results listing HTML samples from `data/recon/results-offset-*.html.gz` and systematically discovers and verifies CSS selectors using BeautifulSoup.

**Analysis targets (verify each selector against ALL 3 results page samples):**

1. **Page structure:**
   - Container for all match results (`.results-holder` or similar)
   - Date grouping container (results are grouped by date)
   - Date header element and its format (text content + any `data-zonedgrouping-*` attributes)
   - Individual match entry container (expected: `.result-con`)
   - Featured/big results section (expected: `.big-results`)

2. **Per-match-entry fields (inside each `.result-con` or equivalent):**
   - Team 1 name: selector, text extraction method
   - Team 2 name: selector, text extraction method
   - Team 1 logo: selector, `src` attribute
   - Team 2 logo: selector, `src` attribute
   - Match score: selector (expected: `.result-score`), parsing format ("2 - 1" -> split on " - ")
   - Match format/map: selector (expected: `.map-text`), values (e.g., "bo3", "bo1", map name for BO1)
   - Match URL (href): selector, pattern for extracting match_id from `/matches/{id}/{slug}`
   - Star rating: selector (expected: `.stars i`), count method
   - Event name: selector if present on listing page
   - Event logo: selector if present
   - LAN/online indicator: selector if present

3. **Pagination mechanics:**
   - How pagination works: URL offset parameter (`?offset=N`)
   - How many entries per page (count `.result-con` elements)
   - How to detect last page (no more results vs empty page vs specific element)
   - Whether "Load more" or infinite scroll is used (unlikely for /results, but verify)

4. **Structural observations:**
   - Are there ads or non-match elements interspersed that a parser must skip?
   - Do featured results (`.big-results`) have a different structure than regular results?
   - Are there "LIVE" match indicators mixed in?
   - Any elements present on offset=0 but absent on offset=5000 (or vice versa)?

**Verification approach:**
For each selector, run `soup.select(selector)` on all 3 samples and report:
- Number of matches found per sample
- Example text/attribute values from the first match
- Whether the selector works consistently across all samples

**Reference selectors from RESEARCH.md to verify:**
- `.result-con` (match entry)
- `.result-score` (score)
- `.map-text` (format/map)
- `div.team` (team name)
- `img.team-logo` (team logo)
- `[data-zonedgrouping-entry-unix]` (match date)
- `.stars i` (star rating)

**Output the results directly into the documentation file** (do NOT just print to console). The script should generate the markdown content and write it to the doc file, OR you can run the script, capture output, and manually compose the doc. Either approach is fine -- what matters is the final document quality.

**Document ALL visible fields**, even ones we might skip during extraction. Mark each field with an extraction status:
- **extract**: We will parse this in Phase 4
- **skip**: Visible but not needed (e.g., team logos)
- **future**: Might extract later (e.g., event logo)
  </action>
  <verify>
The file `.planning/phases/03-page-reconnaissance/recon/results-listing.md` exists and contains:
1. A field-by-field selector table with CSS selectors, data types, optionality, and example values
2. Annotated HTML snippets showing DOM structure
3. Pagination mechanics section
4. Verification notes confirming selectors work across all 3 samples
5. All fields marked with extraction status (extract/skip/future)
  </verify>
  <done>Complete selector map for results listing page exists, all selectors verified against 3 HTML samples, pagination documented, and every visible field cataloged with extraction status</done>
</task>

</tasks>

<verification>
1. `.planning/phases/03-page-reconnaissance/recon/results-listing.md` exists and is 100+ lines
2. Document contains a selector table covering at minimum: team names, score, format, match URL, date, star rating
3. Pagination section documents offset mechanics and stop condition
4. Each selector has been tested against multiple samples (verification notes present)
5. Annotated HTML snippets show actual DOM structure from fetched samples
</verification>

<success_criteria>
- Every extractable field on the results listing page has a documented CSS selector
- Selectors are verified working against all 3 saved HTML samples (offset 0, 100, 5000)
- Pagination mechanics are fully documented (offset increment, entries per page, stop detection)
- Structural differences between samples (if any) are noted
- Document is detailed enough for Phase 4 to build a parser without needing to inspect HTML
</success_criteria>

<output>
After completion, create `.planning/phases/03-page-reconnaissance/03-02-SUMMARY.md`
</output>
