---
phase: 03-page-reconnaissance
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - .planning/phases/03-page-reconnaissance/recon/map-stats.md
autonomous: true

must_haves:
  truths:
    - "CSS selectors for the per-player scoreboard (kills, deaths, assists, ADR, KAST, rating, etc.) are documented"
    - "Round history DOM structure is documented including round outcome types and half separators"
    - "CT-side and T-side round win counts extraction is documented"
    - "Overtime round history structure is documented (how extra rounds appear beyond regulation 24)"
    - "Selectors are verified programmatically against multiple saved HTML samples"
  artifacts:
    - path: ".planning/phases/03-page-reconnaissance/recon/map-stats.md"
      provides: "Complete selector map for HLTV /stats/matches/mapstatsid/{id}/{slug} pages"
      min_lines: 150
  key_links:
    - from: "recon/map-stats.md"
      to: "data/recon/mapstats-*-stats.html.gz"
      via: "BeautifulSoup .select() verification"
      pattern: "soup\\.select"
---

<objective>
Analyze the HLTV map overview (stats) page (`/stats/matches/mapstatsid/{id}/{slug}`) to produce a complete CSS selector map for the per-player scoreboard, round-by-round history, and side stats.

Purpose: This selector map will be consumed directly by Phase 6 (Map Stats Extraction) to build the map stats parser.
Output: `.planning/phases/03-page-reconnaissance/recon/map-stats.md`
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-page-reconnaissance/03-RESEARCH.md
@.planning/phases/03-page-reconnaissance/03-01-SUMMARY.md
@.planning/phases/03-page-reconnaissance/recon/sample-manifest.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Programmatic selector discovery for map stats page</name>
  <files>.planning/phases/03-page-reconnaissance/recon/map-stats.md</files>
  <action>
Write a temporary analysis script that loads ALL map stats HTML samples from `data/recon/mapstats-*-stats.html.gz` and systematically discovers and verifies CSS selectors using BeautifulSoup.

**Analysis targets -- verify each selector against ALL map stats samples:**

**Section 1: Match/map metadata at top of page**
- Team names (how they appear on this page -- different selectors from match overview)
- Team round totals (expected: `.team-left .bold`, `.team-right .bold`)
- Map name (if shown on this page)
- Match info box (expected: `.match-info-box`) -- what metadata is inside?
- Half results: CT-side rounds, T-side rounds per team (expected: `.match-info-row .right`)
- Overtime indicator (how is overtime reflected in the match info section?)

**Section 2: Per-player scoreboard (the main stats table)**
- Stats table container (expected: `.stats-table.totalstats` -- TWO tables, one per team)
- Table header row -- document ALL column headers as they appear in the HTML
- For EACH column, document:
  - Player name (expected: `.st-player a`)
  - Player ID (from href `/player/{id}/{name}` or `data-player-id` attribute)
  - Kills (expected: `.st-kills`)
  - Assists (expected: `.st-assists` -- note if this includes flash assists separately)
  - Flash assists (separate column? or merged with assists?)
  - Deaths (expected: `.st-deaths`)
  - K/D ratio (expected: `.st-kdratio`)
  - K/D diff (expected: `.st-kddiff`, format: "+N" or "-N")
  - ADR (expected: `.st-adr`)
  - KAST% (selector? -- may or may not be on this page vs performance page)
  - First kills diff (expected: `.st-fkdiff`)
  - Rating (expected: `.st-rating`)
  - Rating label/version indicator (expected: `.ratingDesc`)
  - Any other columns present (document ALL, even unexpected ones)

- Which team is in which table? (first table = team1? or determined by another element?)
- Row count per table (should be 5 per team for standard matches)

**Section 3: Round history**
- Round history container
- Round history rows (expected: `.round-history-team-row` -- one per team)
- Individual round outcome elements (expected: `.round-history-outcome`)
- Round outcome types: what classes/attributes indicate win/loss, bomb plant/defuse/elimination/time?
- Half separator (expected: `.round-history-bar`) -- how does it appear in DOM?
- Overtime rounds: in the overtime sample, document how rounds beyond 24 appear
  - Are there additional `.round-history-bar` separators between OT halves?
  - Do OT rounds use different classes?
  - How many total `.round-history-outcome` elements are there?

**Section 4: Overview table (team comparison stats)**
- Overview table (expected: `.overview-table`)
- Row labels (what team-level stats are shown: kills, deaths, assists, etc.)
- Team 1 column (expected: `.team1-column`)
- Team 2 column (expected: `.team2-column`)
- Document ALL rows in this table

**Section 5: Other elements on the page**
- Stat leader boxes (expected: `.most-x-box`) -- most kills, most deaths, etc.
- Highlighted player section (expected: `.highlighted-player`)
- Performance graph (expected: `.graph.small[data-fusionchart-config]`) -- is this JSON data useful?
- Navigation links to performance/economy sub-pages (selectors for those links)
- Eco-adjusted toggle (if present on this page -- post Oct 2025)

**Annotated HTML snippets -- include for:**
- Stats table structure (header + one player row)
- Round history structure (show half separator and ~5 rounds)
- Overtime round history (show the transition from regulation to OT)
- Overview table structure

**For EACH selector:**
- Run `soup.select(selector)` on all samples
- Record: count per sample, example values, consistency
- If selector fails on any sample, investigate and document the variation
- Pay special attention to the overtime sample for round history differences

**Document ALL visible fields.** Mark with extraction status:
- **extract**: Phase 6 will parse this
- **skip**: Present but not needed (stat leader boxes, highlighted player, performance graph)
- **future**: Might extract later (overview table team stats)
  </action>
  <verify>
The file `.planning/phases/03-page-reconnaissance/recon/map-stats.md` exists and contains:
1. Selector tables for all 5 sections (metadata, scoreboard, round history, overview table, other)
2. Complete column-by-column documentation of the stats table
3. Round history DOM structure with outcome types and half separators
4. Overtime round history differences documented
5. Annotated HTML snippets for key structures
6. Verification notes confirming selectors tested against all samples
7. All fields marked with extraction status
8. Document is 150+ lines
  </verify>
  <done>Complete selector map for map stats page exists, scoreboard columns fully documented, round history structure (including overtime) documented, all selectors verified against multiple samples</done>
</task>

</tasks>

<verification>
1. `.planning/phases/03-page-reconnaissance/recon/map-stats.md` exists and is 150+ lines
2. Scoreboard section documents every column with CSS selector, data type, and parsing notes
3. Round history section documents outcome types, half separators, and overtime handling
4. CT/T side round extraction is clearly documented
5. Every selector tested against multiple samples with verification notes
6. Overtime sample analysis explicitly documented
</verification>

<success_criteria>
- Every scoreboard column has a documented CSS selector with data type and example value
- Round history DOM structure fully documented including overtime round representation
- CT/T side round counts extraction path documented
- Team attribution (which table = which team) documented
- Document is detailed enough for Phase 6 to build a parser without needing to inspect HTML
</success_criteria>

<output>
After completion, create `.planning/phases/03-page-reconnaissance/03-04-SUMMARY.md`
</output>
